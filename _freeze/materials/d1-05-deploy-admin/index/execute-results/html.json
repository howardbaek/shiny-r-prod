{
  "hash": "31358eec55390f8b122b9d659980662f",
  "result": {
    "markdown": "---\ntitle: \"Deployment & Administration\"\nsubtitle: \"posit::conf(2023) <br> Shiny in Production: Tools & Techniques\"\nfooter: \"[{{< var workshop_short_url >}}]({{< var workshop_full_url >}})\"\nformat: \n  revealjs:\n    theme: [default, ../slides.scss] # moon= teal bg  |  dark\n    scrollable: true\n    incremental: false\n    slide-number: c/t # c/t | c | h/v | h.v\n    slide-tone: false #true\n    code-line-numbers: true\n    history: false\nrevealjs-plugins:\n  - codewindow\n---\n\n\n## Choose your Adventure\n\n\n::: {.cell}\n<style type=\"text/css\">\n.centerheading h2 {\n  text-align: center;\n}\n\n.mono {\n  font-family: monospace;\n  font-size: 1.4em;\n}\n\n.center-xy {\n  margin: 0;\n  position: absolute;\n  top: 25%;\n  left: 0%;\n  -ms-transform: translateY(-50%), translateX(-50%);\n  transform: translateY(-50%), translateX(-50%);\n}\n</style>\n:::\n\n\n:::: columns\n::: {.column width=\"50%\"}\n### Posit Connect\n\n![](assets/img/shiny.png){width=\"80%\"}\n\n:::\n\n::: {.column width=\"50%\"}\n### Containers\n\n![](assets/img/Rlogo.png){width=\"50%\"}\n\n![](assets/img/linux.png){width=\"50%\"}\n\n:::\n::::\n\n## Deployment Checklist\n\nâœ… Create `app.R` in directory\n\nâœ… Take note of any custom environment variables\n\nâœ… Ensure `DESCRIPTION` is up-to-date with required packages\n\nâœ… Remove outdated functions / scripts\n\n\n\n## {.center-xy}\n\n::: mono\n::: {.codewindow .r}\n03_deploy.R\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## RStudio ----\n## If you want to deploy on RStudio related platforms\ngolem::add_rstudioconnect_file()\ngolem::add_shinyappsio_file()\ngolem::add_shinyserver_file()\n```\n:::\n\n:::\n:::\n\n---\n\n::: mono\n::: {.codewindow .r width=\"1000px\"}\n03_deploy.R\n\n::: {.cell}\n\n```{.r .cell-code}\nrsconnect::deployApp(\n  appName = \"legobricksapp\",\n  appTitle = desc::desc_get_field(\"Package\"),\n  appFiles = c(\n    \"R/\",\n    \"inst/\",\n    \"data/\",\n    \"NAMESPACE\",\n    \"DESCRIPTION\",\n    \"app.R\"\n  ),\n  appId = rsconnect::deployments(\".\")$appId,\n  lint = FALSE,\n  forceUpdate = TRUE\n)\n```\n:::\n\n:::\n:::\n\n# Code-Along {background-color=\"#17395c\"}\n\nDeploy your application(s) to Posit Connect:\n\n* Use any of the applications from a previous exercise\n* Attempt both deployment types (push-button & `{rsconnect}`)\n* Explore application settings in Posit Connect\n\n## Balancing Act {.centerheading}\n\n:::: {.columns}\n\n::: {.column width=\"33%\"}\n\nðŸ”¼ Max Processes\n\n* More resources dedicated to particular application\n* Potential for server overload\n\n:::\n\n::: {.column width=\"33%\"}\n\n![](assets/img/teeter_totter.png)\n\n:::\n\n::: {.column width=\"33%\"}\n\nðŸ”¼ Min Processes\n\n* Resources dedicated even when app is idle\n* Potentially wasteful if app is not used concurrently often\n\n:::\n\n::::\n\n## Containers for Shiny Deployment\n\n* Anyone with a container runtime can execute your container **without R on their system**\n    + Popular container runtimes: Docker, Podman, LXC\n\n* A multitude of web services offer *serverless* app deployments with containers\n    + Bring your container image, they take care of the rest\n    + Terrific reviews available at [hosting.analythium.io](https://hosting.analythium.io)\n\n. . . \n\n**Coming soon**: Container support for Posit Connect\n\n## Business Talk {background-image=\"assets/img/lego_boss_office.jpg\" background-size=\"cover\" background-color=\"black\"}\n\n## You Might be Asked ...\n\n::: {.fragment}\n\n\"How many people used your app last year?\"\n\n:::\n\n::: {.fragment}\n\n\"How long are users on the app at a given time?\"\n\n:::\n\n::: {.fragment}\n::: {.fragment .strike}\n\"What is the return on investment (ROI) this app is bringing the company?\"\n:::\n:::\n\n::: {.fragment}\n\n:::: {.columns}\n\n::: {.column width=\"55%\"}\n![](assets/img/daniel-bryan-no.gif){width=90%}\n:::\n\n::: {.column width=\"30%\"}\n### NOT TODAY!\n:::\n\n::::\n\n:::\n\n## ðŸ“¦ Introducing [`{connectapi}`](https://pkgs.rstudio.com/connectapi/)\n\n> R client for the [Posit Connect Server API](https://docs.posit.co/connect/api/) as well as helpful functions that utilize the client\n\nChecklist:\n\nâœ… Create API key for your Posit Connect account\n\nâœ… Create `.Renviron` with following variables: `CONNECT_SERVER`, `CONNECT_API_KEY`\n\n## Introduce Yourself\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(connectapi)\n\nclient <- connect(\n  server = Sys.getenv(\"CONNECT_SERVER\"),\n  api_key = Sys.getenv(\"CONNECT_API_KEY\")\n)\n\nclient\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPosit Connect API Client: \n  Posit Connect Server: https://rsc.training.rstudio.com\n  Posit Connect API Key: ***********FWxW\n```\n\n\n:::\n:::\n\n\n* `client` is an R6 object representing the API client\n* Required parameter for many convenience functions\n\n## Know Yourself\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_guid <- user_guid_from_username(client, \"rpodcast\")\n\nmy_guid\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"47e1338f-54a8-4b0e-9b3c-e4380611b30f\"\n```\n\n\n:::\n:::\n\n\n* All content/users have a **unique indentifier (guid)**\n\n## Obtain (Your) Shiny Apps\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nmeta_df <- get_content(client) |>\n  filter(owner_guid == my_guid) |>\n  select(guid, name, title)\n\nmeta_df\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 27 Ã— 3\n   guid                                 name            title          \n   <chr>                                <chr>           <chr>          \n 1 40dd2969-5d67-4940-89c4-08fe31fd1c74 brickapp        brickapp       \n 2 fba6896e-49e4-45c6-856f-03a3bc4f498f legobricksapp   legobricks.app \n 3 626d6bb1-f36d-4c9b-bc9e-5cb44f46e698 hellogolem22    hellogolem2    \n 4 6f8116dc-eabf-4a64-aacb-4aeffbb4eaa4 golembrochure2  golembrochure  \n 5 a4e6809f-4858-4888-a848-94925d3df4a0 golembrochure   golembrochure  \n 6 f268d424-a286-41b9-91f1-ae458797e64a golemhellolocal golemhellolocal\n 7 4d9124a0-158b-4bd9-9b65-07b877db0906 test            test           \n 8 c60de16e-0b29-4267-a2c5-0eb6815d7999 hellogolem3     hellogolem     \n 9 2aec4c5b-144f-4a6c-8abf-7d07a17d78b2 hellogolem      hellogolem     \n10 344b9f1b-ddbe-4145-a1f0-eb6608662f08 hellogolem2     hellogolem     \n# â„¹ 17 more rows\n```\n\n\n:::\n:::\n\n\n## Usage Metrics\n\nSession durations for the `legobricksapp`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\napp_guid <- \"fba6896e-49e4-45c6-856f-03a3bc4f498f\"\n\nget_usage_shiny(\n  client,\n  content_guid = app_guid,\n  limit = 5\n  ) |>\n  filter(!is.na(ended)) |>\n  mutate(session_duration = ended - started) |>\n  select(user_guid, session_duration)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 Ã— 2\n  user_guid                            session_duration\n  <chr>                                <drtn>          \n1 47e1338f-54a8-4b0e-9b3c-e4380611b30f 10.933333 mins  \n2 47e1338f-54a8-4b0e-9b3c-e4380611b30f  1.216667 mins  \n3 47e1338f-54a8-4b0e-9b3c-e4380611b30f  4.733333 mins  \n4 47e1338f-54a8-4b0e-9b3c-e4380611b30f  6.766667 mins  \n5 47e1338f-54a8-4b0e-9b3c-e4380611b30f  1.183333 mins  \n```\n\n\n:::\n:::\n\n\n## Usage Metrics\n\nHow many users visited `legobricksapp` in last 28 days?\n\n\n::: {.cell}\n\n```{.r .cell-code}\napp_guid <- \"fba6896e-49e4-45c6-856f-03a3bc4f498f\"\ntime_start <- Sys.Date() - lubridate::days(28)\nget_usage_shiny(\n  client,\n  content_guid = app_guid,\n  limit = 100,\n  from = time_start\n  ) |>\n  pull(user_guid) |>\n  unique() |>\n  length()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n:::\n\n\n## Your Turn\n\nObtain metadata for your deployed application(s) on Posit Connect\n\n* Explore the data as you like!\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_37c22a0b\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">05</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n## Going Further with Metrics\n\nCollection of interesting use cases available at [github.com/sol-eng/connect-usage](https://github.com/sol-eng/connect-usage)\n\n* Most-viewed content in last 30 days\n* [Interactive dashboard](https://colorado.posit.co/rsc/usage-interactive/) of usage metrics\n* [`{connectViz}`](https://github.com/RinteRface/connectViz): Collection of customizable functions for visualizing content usage for an organization\n\n## Our Journey is Complete!\n\n:::: {.columns}\n\n::: {.column width=\"70%\"}\n\n![](assets/img/lego_victory.jpg)\n\n:::\n\n::: {.column width=\"30%\"}\n\n::: {style=\"font-size: 70%\"}\n* Robust app infrastructure with `{golem}`\n* Profiling your app with `{profvis}`\n* Solving performance bottlenecks\n* Assessing your app under high user load\n* Efficient app deployments and tuning\n* Obtaining usage metrics\n:::\n\n:::\n\n::::\n\n::: footer\n[pos.it/conf-workshop-survey](https://pos.it/conf-workshop-survey)\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}